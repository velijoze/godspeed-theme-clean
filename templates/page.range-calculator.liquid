<!-- /templates/page.range-calculator.liquid -->
{% comment %}
  This page template is for the e-bike range calculator tool.
  Be sure to select page.range-calculator as the template from the admin page to have this template take effect.
{% endcomment %}

<div class="wrapper page-margin">
  <div class="grid">
    <div class="grid__item large--two-thirds push--large--one-sixth">
      <h1 class="text-center h2">{{ page.title }}</h1>
      <div class="rte">
        {{ page.content }}
      </div>
      
      <!-- Range Calculator Tool -->
      <div class="range-calculator-container">
        <div class="calculator-intro">
          <h3>E-Bike Range Calculator</h3>
          <p>Estimate your e-bike's range based on terrain, weight, weather, and riding conditions.</p>
        </div>
        
        <!-- Calculator Form -->
        <div class="calculator-form">
          <div class="form-section">
            <h4>Bike Specifications</h4>
            <div class="form-row">
              <div class="form-group">
                <label for="battery-capacity">Battery Capacity (Wh)</label>
                <select id="battery-capacity" name="battery-capacity">
                  <option value="250">250 Wh</option>
                  <option value="400" selected>400 Wh</option>
                  <option value="500">500 Wh</option>
                  <option value="625">625 Wh</option>
                  <option value="750">750 Wh</option>
                  <option value="1000">1000 Wh</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="motor-power">Motor Power (W)</label>
                <select id="motor-power" name="motor-power">
                  <option value="250" selected>250 W</option>
                  <option value="350">350 W</option>
                  <option value="500">500 W</option>
                  <option value="750">750 W</option>
                  <option value="1000">1000 W</option>
                </select>
              </div>
            </div>
          </div>
          
          <div class="form-section">
            <h4>Riding Conditions</h4>
            <div class="form-row">
              <div class="form-group">
                <label for="terrain-type">Terrain Type</label>
                <select id="terrain-type" name="terrain-type">
                  <option value="flat" selected>Flat (0% grade)</option>
                  <option value="rolling">Rolling (5-10% grade)</option>
                  <option value="hilly">Hilly (10-20% grade)</option>
                  <option value="mountainous">Mountainous (20%+ grade)</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="wind-conditions">Wind Conditions</label>
                <select id="wind-conditions" name="wind-conditions">
                  <option value="calm" selected>Calm (0-5 mph)</option>
                  <option value="light">Light breeze (5-10 mph)</option>
                  <option value="moderate">Moderate (10-15 mph)</option>
                  <option value="strong">Strong (15-25 mph)</option>
                  <option value="headwind">Headwind (against you)</option>
                </select>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="temperature">Temperature (¬∞F)</label>
                <select id="temperature" name="temperature">
                  <option value="32">32¬∞F (0¬∞C) - Cold</option>
                  <option value="50">50¬∞F (10¬∞C) - Cool</option>
                  <option value="70" selected>70¬∞F (21¬∞C) - Ideal</option>
                  <option value="85">85¬∞F (29¬∞C) - Warm</option>
                  <option value="95">95¬∞F (35¬∞C) - Hot</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="road-surface">Road Surface</label>
                <select id="road-surface" name="road-surface">
                  <option value="paved" selected>Paved (smooth)</option>
                  <option value="rough">Rough pavement</option>
                  <option value="gravel">Gravel/dirt</option>
                  <option value="off-road">Off-road/trail</option>
                </select>
              </div>
            </div>
          </div>
          
          <div class="form-section">
            <h4>Rider & Cargo</h4>
            <div class="form-row">
              <div class="form-group">
                <label for="rider-weight">Rider Weight (lbs)</label>
                <input type="number" id="rider-weight" name="rider-weight" placeholder="160" min="80" max="300" value="160">
              </div>
              
              <div class="form-group">
                <label for="cargo-weight">Cargo Weight (lbs)</label>
                <input type="number" id="cargo-weight" name="cargo-weight" placeholder="20" min="0" max="100" value="20">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="assist-level">Assist Level</label>
                <select id="assist-level" name="assist-level">
                  <option value="eco">Eco (minimal assist)</option>
                  <option value="tour" selected>Tour (moderate assist)</option>
                  <option value="sport">Sport (high assist)</option>
                  <option value="turbo">Turbo (maximum assist)</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="riding-style">Riding Style</label>
                <select id="riding-style" name="riding-style">
                  <option value="leisurely" selected>Leisurely (10-12 mph)</option>
                  <option value="moderate">Moderate (12-15 mph)</option>
                  <option value="fast">Fast (15-20 mph)</option>
                  <option value="racing">Racing (20+ mph)</option>
                </select>
              </div>
            </div>
          </div>
          
          <button type="button" class="btn btn--primary btn--large" onclick="calculateRange()">
            Calculate Range
          </button>
        </div>
        
        <!-- Results -->
        <div id="range-results" class="range-results" style="display: none;">
          <h4>Your Range Estimate</h4>
          
          <div class="range-summary">
            <div class="range-main">
              <div class="range-value" id="estimated-range">45-65 miles</div>
              <div class="range-label">Estimated Range</div>
            </div>
          </div>
          
          <div class="range-details">
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">Battery Usage:</span>
                <span class="detail-value" id="battery-usage">80%</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Efficiency:</span>
                <span class="detail-value" id="efficiency">12.5 Wh/mile</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Riding Time:</span>
                <span class="detail-value" id="riding-time">3-4 hours</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Energy Cost:</span>
                <span class="detail-value" id="energy-cost">$0.08</span>
              </div>
            </div>
          </div>
          
          <div class="range-factors">
            <h5>Factors Affecting Your Range</h5>
            <div class="factors-list">
              <div class="factor-item positive">
                <span class="factor-icon">‚úÖ</span>
                <span class="factor-text">Flat terrain provides optimal efficiency</span>
              </div>
              <div class="factor-item positive">
                <span class="factor-icon">‚úÖ</span>
                <span class="factor-text">Moderate assist level conserves battery</span>
              </div>
              <div class="factor-item neutral">
                <span class="factor-icon">‚ö†Ô∏è</span>
                <span class="factor-text">Light cargo weight has minimal impact</span>
              </div>
              <div class="factor-item negative">
                <span class="factor-icon">‚ùå</span>
                <span class="factor-text">Higher speeds increase energy consumption</span>
              </div>
            </div>
          </div>
          
          <div class="range-tips">
            <h5>Tips to Extend Your Range</h5>
            <div class="tips-grid">
              <div class="tip-card">
                <div class="tip-icon">üîã</div>
                <h6>Use Eco Mode</h6>
                <p>Switch to eco mode on flat sections to conserve battery</p>
              </div>
              <div class="tip-card">
                <div class="tip-icon">üö¥</div>
                <h6>Pedal Assist</h6>
                <p>Combine motor power with your own pedaling effort</p>
              </div>
              <div class="tip-card">
                <div class="tip-icon">üå°Ô∏è</div>
                <h6>Temperature</h6>
                <p>Store battery indoors in cold weather for better performance</p>
              </div>
              <div class="tip-card">
                <div class="tip-icon">‚ö°</div>
                <h6>Regular Maintenance</h6>
                <p>Keep tires inflated and drivetrain clean for efficiency</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="calculator-actions">
          <button class="btn btn--secondary" onclick="resetRangeCalculator()">Reset</button>
          <button class="btn btn--primary" onclick="saveCalculation()">Save Calculation</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Custom styles for range calculator page -->
<style>
  .range-calculator-container {
    margin: 3rem 0;
    background: #ffffff;
    border-radius: 16px;
    padding: 2rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    border: 2px solid #f0f0f0;
  }
  
  .calculator-intro {
    text-align: center;
    margin-bottom: 2rem;
  }
  
  .calculator-intro h3 {
    font-size: 1.75rem;
    color: #2c2c2c;
    margin-bottom: 1rem;
  }
  
  .calculator-intro p {
    color: #666;
    font-size: 1.1rem;
  }
  
  .calculator-form {
    max-width: 800px;
    margin: 0 auto 2rem auto;
  }
  
  .form-section {
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: #f8f9fa;
    border-radius: 12px;
    border: 1px solid #e0e0e0;
  }
  
  .form-section h4 {
    color: #2c2c2c;
    margin-bottom: 1rem;
    font-size: 1.2rem;
    border-bottom: 2px solid #007bff;
    padding-bottom: 0.5rem;
  }
  
  .form-row {
    display: flex;
    gap: 1.5rem;
    margin-bottom: 1rem;
  }
  
  .form-group {
    flex: 1;
  }
  
  .form-group label {
    display: block;
    font-weight: 600;
    color: #2c2c2c;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
  }
  
  .form-group input,
  .form-group select {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.3s ease;
    background: #ffffff;
  }
  
  .form-group input:focus,
  .form-group select:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
  }
  
  .btn--large {
    width: 100%;
    padding: 1rem;
    font-size: 1.1rem;
    font-weight: 600;
    margin-top: 1rem;
  }
  
  .range-results {
    margin-top: 2rem;
    padding: 2rem;
    background: #f8f9fa;
    border-radius: 12px;
    border: 2px solid #e0e0e0;
  }
  
  .range-results h4 {
    text-align: center;
    color: #2c2c2c;
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
  }
  
  .range-summary {
    text-align: center;
    margin-bottom: 2rem;
  }
  
  .range-main {
    background: #ffffff;
    padding: 2rem;
    border-radius: 12px;
    border: 2px solid #007bff;
    box-shadow: 0 4px 12px rgba(0,123,255,0.1);
  }
  
  .range-value {
    font-size: 3rem;
    font-weight: 700;
    color: #007bff;
    margin-bottom: 0.5rem;
  }
  
  .range-label {
    font-size: 1.1rem;
    color: #666;
    font-weight: 500;
  }
  
  .range-details {
    background: #ffffff;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
    border: 1px solid #e0e0e0;
  }
  
  .detail-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }
  
  .detail-item {
    display: flex;
    justify-content: space-between;
    padding: 0.75rem;
    background: #f8f9fa;
    border-radius: 6px;
    border: 1px solid #e0e0e0;
  }
  
  .detail-label {
    font-weight: 600;
    color: #2c2c2c;
  }
  
  .detail-value {
    font-weight: 700;
    color: #007bff;
  }
  
  .range-factors h5,
  .range-tips h5 {
    color: #2c2c2c;
    margin-bottom: 1rem;
    font-size: 1.1rem;
  }
  
  .factors-list {
    background: #ffffff;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
    border: 1px solid #e0e0e0;
  }
  
  .factor-item {
    display: flex;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid #f0f0f0;
  }
  
  .factor-item:last-child {
    border-bottom: none;
  }
  
  .factor-icon {
    margin-right: 1rem;
    font-size: 1.2rem;
  }
  
  .factor-item.positive .factor-text {
    color: #28a745;
  }
  
  .factor-item.neutral .factor-text {
    color: #ffc107;
  }
  
  .factor-item.negative .factor-text {
    color: #dc3545;
  }
  
  .tips-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
  }
  
  .tip-card {
    background: #ffffff;
    padding: 1.5rem;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
    text-align: center;
  }
  
  .tip-icon {
    font-size: 2rem;
    margin-bottom: 1rem;
  }
  
  .tip-card h6 {
    color: #2c2c2c;
    margin-bottom: 0.5rem;
    font-size: 1rem;
  }
  
  .tip-card p {
    color: #666;
    font-size: 0.9rem;
    margin: 0;
    line-height: 1.4;
  }
  
  .calculator-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-top: 2rem;
  }
  
  .btn--secondary {
    background: #6c757d;
    color: #ffffff;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .btn--secondary:hover {
    background: #5a6268;
    transform: translateY(-1px);
  }
  
  .btn--primary {
    background: #007bff;
    color: #ffffff;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .btn--primary:hover {
    background: #0056b3;
    transform: translateY(-1px);
  }
  
  /* Responsive design */
  @media (max-width: 768px) {
    .range-calculator-container {
      padding: 1.5rem;
      margin: 2rem 0;
    }
    
    .form-row {
      flex-direction: column;
      gap: 1rem;
    }
    
    .detail-grid {
      grid-template-columns: 1fr;
    }
    
    .tips-grid {
      grid-template-columns: 1fr;
    }
    
    .calculator-actions {
      flex-direction: column;
      align-items: center;
    }
    
    .range-value {
      font-size: 2rem;
    }
  }
</style>

<!-- Range calculation JavaScript -->
<script>
  function calculateRange() {
    // Get form values
    const batteryCapacity = parseInt(document.getElementById('battery-capacity').value);
    const motorPower = parseInt(document.getElementById('motor-power').value);
    const terrainType = document.getElementById('terrain-type').value;
    const windConditions = document.getElementById('wind-conditions').value;
    const temperature = parseInt(document.getElementById('temperature').value);
    const roadSurface = document.getElementById('road-surface').value;
    const riderWeight = parseInt(document.getElementById('rider-weight').value);
    const cargoWeight = parseInt(document.getElementById('cargo-weight').value);
    const assistLevel = document.getElementById('assist-level').value;
    const ridingStyle = document.getElementById('riding-style').value;
    
    // Base efficiency calculation (Wh per mile)
    let baseEfficiency = 12.5;
    
    // Adjust for battery capacity
    if (batteryCapacity >= 750) baseEfficiency *= 0.9;
    else if (batteryCapacity <= 250) baseEfficiency *= 1.2;
    
    // Adjust for motor power
    if (motorPower >= 750) baseEfficiency *= 1.3;
    else if (motorPower <= 250) baseEfficiency *= 0.8;
    
    // Adjust for terrain
    const terrainMultipliers = {
      'flat': 1.0,
      'rolling': 1.3,
      'hilly': 1.8,
      'mountainous': 2.5
    };
    baseEfficiency *= terrainMultipliers[terrainType];
    
    // Adjust for wind
    const windMultipliers = {
      'calm': 1.0,
      'light': 1.1,
      'moderate': 1.2,
      'strong': 1.4,
      'headwind': 1.6
    };
    baseEfficiency *= windMultipliers[windConditions];
    
    // Adjust for temperature
    if (temperature <= 32) baseEfficiency *= 1.3;
    else if (temperature >= 95) baseEfficiency *= 1.2;
    
    // Adjust for road surface
    const surfaceMultipliers = {
      'paved': 1.0,
      'rough': 1.2,
      'gravel': 1.4,
      'off-road': 1.6
    };
    baseEfficiency *= surfaceMultipliers[roadSurface];
    
    // Adjust for weight
    const totalWeight = riderWeight + cargoWeight;
    if (totalWeight > 200) baseEfficiency *= 1.2;
    else if (totalWeight < 140) baseEfficiency *= 0.9;
    
    // Adjust for assist level
    const assistMultipliers = {
      'eco': 0.7,
      'tour': 1.0,
      'sport': 1.4,
      'turbo': 2.0
    };
    baseEfficiency *= assistMultipliers[assistLevel];
    
    // Adjust for riding style
    const styleMultipliers = {
      'leisurely': 0.8,
      'moderate': 1.0,
      'fast': 1.3,
      'racing': 1.8
    };
    baseEfficiency *= styleMultipliers[ridingStyle];
    
    // Calculate range
    const usableCapacity = batteryCapacity * 0.8; // 80% usable capacity
    const estimatedRange = Math.round(usableCapacity / baseEfficiency);
    
    // Calculate range variation (¬±20%)
    const minRange = Math.round(estimatedRange * 0.8);
    const maxRange = Math.round(estimatedRange * 1.2);
    
    // Calculate other metrics
    const batteryUsage = Math.round((usableCapacity / batteryCapacity) * 100);
    const efficiency = (usableCapacity / estimatedRange).toFixed(1);
    const ridingTime = Math.round(estimatedRange / 15); // Assuming 15 mph average
    const energyCost = ((usableCapacity / 1000) * 0.12).toFixed(2); // $0.12 per kWh
    
    // Update results
    document.getElementById('estimated-range').textContent = `${minRange}-${maxRange} miles`;
    document.getElementById('battery-usage').textContent = `${batteryUsage}%`;
    document.getElementById('efficiency').textContent = `${efficiency} Wh/mile`;
    document.getElementById('riding-time').textContent = `${ridingTime}-${ridingTime + 1} hours`;
    document.getElementById('energy-cost').textContent = `$${energyCost}`;
    
    // Show results
    document.getElementById('range-results').style.display = 'block';
    
    // Scroll to results
    document.getElementById('range-results').scrollIntoView({ behavior: 'smooth' });
  }
  
  function resetRangeCalculator() {
    document.getElementById('battery-capacity').value = '400';
    document.getElementById('motor-power').value = '250';
    document.getElementById('terrain-type').value = 'flat';
    document.getElementById('wind-conditions').value = 'calm';
    document.getElementById('temperature').value = '70';
    document.getElementById('road-surface').value = 'paved';
    document.getElementById('rider-weight').value = '160';
    document.getElementById('cargo-weight').value = '20';
    document.getElementById('assist-level').value = 'tour';
    document.getElementById('riding-style').value = 'leisurely';
    
    document.getElementById('range-results').style.display = 'none';
  }
  
  function saveCalculation() {
    alert('Range calculation saved! You can view your saved calculations in your account dashboard.');
  }
</script>
